{% extends "base.html" %}
{% block title %}Monthly Report{% endblock %} 

{% block monthly_report_active %}active{% endblock %}

{% block Head %}
<style>
#chartdiv {
    width: 100%;
    height: 82dvh;
}

</style>
 <!--Chart code -->
<script>
    am4core.ready(function() {
        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end
        // Create chart instance
        var chart = am4core.create("chartdiv", am4charts.XYChart);
        // chart data
        chart.data = {{data | safe}};
        chart.logo.dispose();
        // Create axes
        var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
        categoryAxis.dataFields.category = "uid__first_name";
        categoryAxis.renderer.grid.template.opacity = 0;
        categoryAxis.renderer.minGridDistance = 10

        var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
        valueAxis.min = 0;
        valueAxis.renderer.grid.template.opacity = 0;
        valueAxis.renderer.ticks.template.strokeOpacity = 0.5;
        valueAxis.renderer.ticks.template.stroke = am4core.color("#495C43");
        valueAxis.renderer.ticks.template.length = 8;
        valueAxis.renderer.line.strokeOpacity = 0.5;
        valueAxis.renderer.baseGrid.disabled = true;
        //valueAxis.renderer.minGridDistance = 30;
        // Create series
        // function createSeries(field, name) {
        var series = chart.series.push(new am4charts.ColumnSeries());
        series.dataFields.valueX = "total_hrs";
        series.dataFields.categoryY = "uid__first_name";
        series.stacked = true;
        series.name = name;

        var labelBullet = series.bullets.push(new am4charts.LabelBullet());
        labelBullet.locationX = 0.5;
        labelBullet.label.text = "{valueX}";
        labelBullet.label.fill = am4core.color("#fff");
        //}
        // Enable export
        chart.exporting.menu = new am4core.ExportMenu();
        chart.exporting.filePrefix = "Month Analysis";

        chart.exporting.menu.items = [{
            "label": '<i class="fa fa-download" style ="margin-top :8px"></i>',
            "menu": [{
                "type": "xlsx",
                "label": "XLSX"
            }, ]
        }];
    }); // end am4core.ready()
</script>
{% endblock %} {% block main-content %}

<div class="card">
    <div class="card-header" style="height: 56px;">
        <div class="justify-content-between row mb-2" style="align-items: center;">
            <div class="col-6 col-md-2 col-lg-2">
                <i class="fas fa-chart-bar me-1"></i><strong> Monthly Report</strong>
            </div>
            <div class="col-6 col-md-2 col-lg-9">
                <form class="timesheet_analysis " action="/timeline/employee_month_analysis/" method="POST">
                    {% csrf_token %}
                    <div class="row justify-content-end">
                        <div class="col-6 col-md-4 col-lg-2 mb-2">
                            <div class="form-outline">
                                <input type="date" class="form-control" id="Date" name="from_date" value="{{from_date|safe}}" />
                                <label class="form-label" for="From_date"><i class="fas fa-filter"></i>From</label>
                            </div>
                        </div>
                        <div class="col-6 col-md-4 col-lg-2 mb-2">
                            <div class="form-outline">
                                <input type="date" class="form-control" id="Date" name="to_date" value="{{to_date|safe}}" required />
                                <label class="form-label" for="To_date"><i class="fas fa-filter"></i>To</label>
                            </div>
                        </div>
                        <div class="col-6 col-md-4 col-lg-2 mb-2">
                            <button type="submit" class="form-control bg-info " >SUBMIT</button> 
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="card-body">
        <div id="chartdiv"></div>
    </div>
</div>
<script>
     $(document).ready( function () {
        $('#department').val('{{setectedDept|safe}}')
    });
</script>
{% endblock %}